import numpy as np
from scipy import odr
import matplotlib.pyplot as plt
from matplotlib import rc


#Matpoltlib setup
rc('font', **{'family': 'serif', 'serif': ['Computer Modern']})
rc('text', usetex=True)


def FitterPlotter(x, y, sx, sy, nstd, name):

	#Model function and object
	def fit_function(beta, x):
		A, B = beta
		return A * x + B

	model = odr.Model(fit_function)

	#Data object
	data = odr.RealData(x, y, sx=sx, sy=sy)

	#Set up ODR with model and data
	odrm = odr.ODR(data, model, beta0=[1.0, 1.0])

	#Run regression
	out = odrm.run()


	#Extract parameters
	betaout = out.beta
	betaerr = out.sd_beta
	print('Fit parameters and their std deviations')
	print('-------------------')
	for i in range(len(betaout)):
		print('Parameter {}: '.format(i+1)+str(betaout[i])+' +- '+str(betaerr[i]))

	#Fit curve and confidence intervals
	betaout_up = betaout + nstd * betaerr
	betaout_dw = betaout - nstd * betaerr

	x_dummy = np.linspace(min(x), max(x), 1000)
	fit = fit_function(betaout, x_dummy)
	fit_up = fit_function(betaout_up, x_dummy)
	fit_dw = fit_function(betaout_dw, x_dummy)
	#depending on the sign of d(fit)/d(beta) this may need to be changed


	#Plotting
	figure, axes = plt.subplots(1)

	plt.xlabel(r'Time $t$')
	plt.ylabel(r'Period $T$ [s]')
	plt.title(name)
	plt.grid()

	plt.errorbar(x, y, xerr=sx, yerr=sy, fmt='ko', label='Data')
	plt.plot(x_dummy, fit, label=r'Fit $T=At+B$')
	axes.fill_between(x_dummy, fit_up, fit_dw, alpha=0.25,
		              label='Confidence interval')

	text = (r'$A=({:0.3f}\pm{:0.3f})$'.format(betaout[0], betaerr[0])+'\n'+
		    r'$B=({:0.3f}\pm{:0.3f})\,\mathrm s$'.format(betaout[1],betaerr[1]))
	boxprops = dict(boxstyle='round', facecolor='ivory', alpha=0.5)
	axes.text(0.05, 0.95, text, transform=axes.transAxes, fontsize=14,
	        verticalalignment='top', bbox=boxprops)

	plt.legend(loc='upper right')
	plt.savefig(name + '.png', dpi=500)
	plt.show()



'''
#Plot 1
y1 = [1.312916891, 0.9246556482, -0.2600669054, 0.4567917353, -0.1613431504, 0.7825307417, 0.4593217809, -0.5816058058, 0.2592825979, 0.8666802313,1.336315991, 1.071926023, 1.151520944, 1.581449876, 0.4414755456, 2.254864357, 1.554770511, -0.7360546816, 1.479784704, 1.526056303, -0.6674794338, 2.437290796, 2.785072969, 2.15234343, 1.885249812]
x1 = [i+1 for i in range(len(y1))]

sy1 = [0.02690341673, 0.03966679889, 0.1297016861, 0.06333122229, 0.1175088132, 0.04572473708, 0.06317119394, 0.1788908766, 0.07716049383, 0.04203446826, 0.02628120894, 0.03423485108, 0.03161555485, 0.02056766763, 0.06430868167, 0.01048877701, 0.02112378538, 0.2087682672, 0.02276867031, 0.02173913043, 0.1949317739, 0.008739730816, 0.00617245849, 0.01162115049, 0.01517911354]
sx1 = [10**(-9)] * len(y1)

name1 = 'Magazine paper (first time, r=2.5mm)'

FitterPlotter(x1, y1, sx1, sy1, 1.0, name1)


#Plot 2
y2 = [2.313426116, 2.702836634, 1.540516467, 1.236052698, 1.787584098, 3.00558359, 2.263116349, 0.2366519013, 1.878242929, 1.373715579, 2.218877344, 2.267061537, 2.526128564, 1.909542505, 3.841149796, 2.966869729]
x2 = [i+1 for i in range(len(y2))]

sy2 = [0.009892175289, 0.006701514542, 0.02142704093, 0.02905287623, 0.01673640167, 0.004950985246, 0.01040257984, 0.07892659826, 0.01528584531, 0.0253164557, 0.0108731108, 0.01036162056, 0.007996801279, 0.01481481481, 0.00214689023, 0.005146415522]
sx2 = [10**(-9)] * len(y2)

name2 = 'Smooth thin paper'

FitterPlotter(x2, y2, sx2, sy2, 1.0, name2)


#Plot 3
y3 = [-0.8164453969, -0.9263410677, -1.075872802, -0.5533852382, -0.5533852382, -0.5744756508, -0.6051363032, -0.004008021398, -0.3326794384, 0.4567917353, 0.3967606675, 0.9828272557, 1.2050722, 0.9715362061, 1.726509584, 1.318550709, 1.360976553, 1.931086534, 2.477294417, 2.33020026, 2.32532458, 3.013523075]
x3 = [i+1 for i in range(len(y3))]

sy3 = [0.2262443439, 0.2525252525, 0.293255132, 0.1739130435, 0.1739130435, 0.1776198934, 0.1831501832, 0.1004016064, 0.1394700139, 0.06333122229, 0.06724949563, 0.0374251497, 0.02996703626, 0.03785011355, 0.01779042875, 0.02675227394, 0.02564102564, 0.01449905756, 0.008397010664, 0.009727626459, 0.009775171065, 0.004911832605]
sx3 = [10**(-9)] * len(y3)

name3 = 'Magazine paper (second time, r=2.5mm)'

FitterPlotter(x3, y3, sx3, sy3, 1.0, name3)


#Plot 4
y4 = [1.109, 2.1, 2.325, 3.567, 2.092, 32.686, 13.93, 30.694, 26.648]

sy4 = [0.1] * len(y4)

name4 = 'Thick paper held together with a rubber bandfor one hour before released'

FitterPlotter(x4, y4, sx4, sy4, 1.0, name4)


#Plot 5
y5 = [0.279, 0.425, 0.317, 0.295, 0.334, 0.304, 0.35, 0.367, 0.391, 0.342, 0.412, 0.363, 0.442, 0.354, 0.267, 0.312, 0.33, 0.335, 0.427, 0.333, 0.313, 0.317, 0.354, 0.333, 0.371, 0.279, 0.383]

sy5 = [0.1] * len(y5)

name5 = 'Nikon paper 16cm length'

FitterPlotter(x5, y5, sx5, sy5, 1.0, name5)


#Plot 6
y6 = [-1.276543497, -1.217395825, -1.339410775, -0.9263410677, -0.4620354596, 0.06391332574, 0.3777512695, -0.1199102967, 0.3393253056, 0.9313763693, 0.8346467428, 0.9182887345, 1.192709612, 1.461633718, 1.671661256, 1.468335071, 2.247389458, 1.947908152, 2.808438375, 3.066190737]
x6 = [i+1 for i in range(len(y6))]

sy6 = [0.3584229391, 0.3378378378, 0.3816793893, 0.2525252525, 0.1587301587, 0.09380863039, 0.06854009596, 0.1127395716, 0.07122507123, 0.03940110323, 0.04340277778, 0.03992015968, 0.03033980583, 0.0231857176, 0.01879345988, 0.02303086135, 0.01056747332, 0.01425719989, 0.006029908345, 0.004659832246]
sx6 = [10**(-9)] * len(y6)

name6 = 'Magazine paper (r=4.5mm)'

FitterPlotter(x6, y6, sx6, sy6, 1.0, name6)


#Plot 7
x7 = [1/2.5, 1/4.0, 1/4.5, 1/5.5, 1/3.5]
y7 = [1/3.5, 1/5.0, 1/9.0, 1/13.0, 1/5.0]

sx7 = [0.1/(2.5**2), 0.1/(4.0**2), 0.1/(4.5**2), 0.1/(5.5**2), 0.1/(3.5**2)]
sy7 = [0.1/(3.5**2), 0.1/(5.0**2), 0.1/(9.0**2), 0.1/(13.0**2), 0.1/(5**2)]

name7 = 'Initial versus final curvature (inner)'

FitterPlotter(x7, y7, sx7, sy7, 1.0, name7)


#Plot 8
x8 = [1/4.5, 1/5.0, 1/6.0, 1/7.0, 1/5.5]
y8 = [1/7.5, 1/8.5, 1/11.0, 1/15.0, 1/10.0]

sx8 = [0.1/(4.5**2), 0.1/(5.0**2), 0.1/(6.0**2), 0.1/(7.0**2), 0.1/(5.5**2)]
sy8 = [0.1/(7.5**2), 0.1/(8.5**2), 0.1/(11.0**2), 0.1/(15.0**2), 0.1/(10.0**2)]

name8 = 'Initial versus final curvature (outer)'

FitterPlotter(x8, y8, sx8, sy8, 1.0, name8)
'''

#Plot 1
x1 = [1.092, 1.371, 1.667, 1.929, 2.325, 2.955, 4.021, 5.48, 6.367, 7.771, 10.309, 12.613, 15.118, 18.414, 22.727, 28.048, 32.39, 41.853, 48.867, 65.451]
y1 = [0.279, 0.296, 0.262, 0.396, 0.63, 1.066, 1.459, 0.887, 1.404, 2.538, 2.304, 2.505, 3.296, 4.313, 5.321, 4.342, 9.463, 7.014, 16.584, 21.46]

sx1 = [0.05] * len(y1)
sy1 = [0.1] * len(y1)

name1 = 'Magazine paper (r=4.5mm)'

FitterPlotter(x1, y1, sx1, sy1, 1.0, name1)

#Plot 2
x2 = [24.556, 28.273, 30.794, 31.565, 33.144, 33.995, 36.182, 37.765, 38.324, 39.62, 41.999, 45.804, 48.725, 51.888, 56.75, 58.305, 67.839, 72.573, 73.052, 77.444, 82.044, 82.557, 93.999, 110.2, 118.805]
y2 = [3.717, 2.521, 0.771, 1.579, 0.851, 2.187, 1.583, 0.559, 1.296, 2.379, 3.805, 2.921, 3.163, 4.862, 1.555, 9.534, 4.734, 0.479, 4.392, 4.6, 0.513, 11.442, 16.201, 8.605, 6.588]

sx2 = [0.05] * len(y2)
sy2 = [0.1] * len(y2)

name2 = 'Magazine paper (first time, r=2.5mm)'

FitterPlotter(x2, y2, sx2, sy2, 1.0, name2)

#Plot 3
x3 = [3.496, 3.938, 4.334, 4.675, 5.25, 5.825, 6.388, 6.934, 7.93, 8.647, 10.226, 11.713, 14.385, 17.722, 20.364, 25.985, 29.723, 33.623, 40.52, 52.429, 62.709, 72.939]
y3 = [0.442, 0.396, 0.341, 0.575, 0.575, 0.563, 0.546, 0.996, 0.717, 1.579, 1.487, 2.672, 3.337, 2.642, 5.621, 3.738, 3.9, 6.897, 11.909, 10.28, 10.23, 20.359]

sx3 = [0.05] * len(y3)
sy3 = [0.1] * len(y3)

name3 = 'Magazine paper (second time, r=2.5mm)'

FitterPlotter(x3, y3, sx3, sy3, 1.0, name3)

#Plot 4
x4 = [2.475, 3.584, 5.684, 8.009, 11.576, 13.668, 46.354, 60.284, 90.978]
y4 = [1.109, 2.1, 2.325, 3.567, 2.092, 32.686, 13.93, 30.694, 26.648]

sx4 = [0.05] * len(y4)
sy4 = [0.1] * len(y4)

name4 = 'Thick paper'

FitterPlotter(x4, y4, sx4, sy4, 1.0, name4)

#Plot 5
x5 = [57.68, 67.789, 82.711, 87.378, 90.82, 96.795, 116.993, 126.606, 127.873, 134.415, 138.365, 147.562, 157.213, 169.718, 176.468, 223.047]
y5 = [10.109, 14.922, 4.667, 3.442, 5.975, 20.198, 9.613, 1.267, 6.542, 3.95, 9.197, 9.651, 12.505, 6.75, 46.579, 19.431]

sx5 = [0.05] * len(y5)
sy5 = [0.1] * len(y5)

name5 = 'Smooth thin paper'

FitterPlotter(x5, y5, sx5, sy5, 1.0, name5)
